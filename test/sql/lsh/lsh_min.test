# name: test/sql/lsh/lsh_min.test
# description: test lsh_min function
# group: [lsh]

# This should fail because the extension has not yet been loaded
statement error
SELECT lsh_min('Princeton University', 2, 3, 2, 123);
----
Catalog Error: Scalar Function with name lsh_min does not exist!

# Load the extension
require lsh

# Load another extension required for testing
require icu

# Hash a single string
query I
SELECT lsh_min('Princeton University', 2, 3, 2, 123);
----
[6891191098855684803, 6484452798683863108, 14488917645112899542]

# Hash a string column containing NULL values
query I
CREATE TEMPORARY TABLE temp_names (
    name VARCHAR
);
INSERT INTO temp_names (name) VALUES
    ('Alice Johnson'),
    ('Robert Smith'),
    (NULL),
    ('Charlotte Brown'),
    ('David Martinez'),
    ('Emily Davis'),
    ('Michael Wilson'),
    ('Sophia Taylor'),
    (NULL),
    ('James Anderson'),
    ('Olivia Thomas'),
    ('Benjamin Lee');
SELECT lsh_min(name, 2, 3, 2, 123) AS hash FROM temp_names;
----
[13571929851950895096, 9380027513982184887, 2973452616913389687]
[8779492002049334510, 6213046290947405081, 13321761559668221936]
NULL
[17147317566672094549, 9868884775472345505, 9544039307031965287]
[8205471107123956470, 3856457550471365223, 160978381860159594]
[5031590273592478399, 2643794611755346220, 10496886524478706543]
[7351019434982270461, 11969544284460938578, 1096653296545732983]
[947309311728102588, 6485027977500841069, 11465726828575944543]
NULL
[6511242524203601686, 5368660891928216176, 4531328875985401258]
[6134578107120707744, 8471287122008225606, 13561556383590060017]
[7926739398273580158, 2501438919389423193, 17085734390799214704]

# Hash a custom shingle set (word bigrams)
query I
SELECT lsh_min(ARRAY['Today is', 'is such', 'such a', 'a beautiful', 'beautiful day'], 3, 2, 123);
----
[9974840119851185478, 4711155484753061995, 16211519798383806619]

# Hash a custom shingle set column containing NULL values
query I
CREATE OR REPLACE TEMPORARY TABLE temp_sentences (
    shingles VARCHAR[],
);
INSERT INTO temp_sentences (shingles) VALUES
    (ARRAY['Today is', 'is such', 'such a', 'a beautiful', 'beautiful day']),
    (NULL),
    (ARRAY['Jane was', 'was happy', 'happy to', 'to hear', 'hear the', 'the news']);
SELECT lsh_min(shingles, 3, 2, 123) AS hash FROM temp_sentences;
----
[9974840119851185478, 4711155484753061995, 16211519798383806619]
NULL
[2354814969659523670, 7221458756809834639, 17094615994155466934]
